---
title: "MTHM501 Assessment Report"
author: "Kevin Donkers (EI CDT) - 700063874"
date: "11/11/2020"
output:
  bookdown::pdf_document2:
    fig_caption: yes
  bookdown::html_document2:
    fig_caption: yes
    smart: no
---

```{r setup, include=FALSE}
library(here)
library(bookdown)
knitr::opts_chunk$set(echo = FALSE, message=FALSE, cache=FALSE, warning=FALSE, include = FALSE)
knitr::read_chunk(here::here('scripts/tidy_data.R'))
knitr::read_chunk(here::here('scripts/inspect_data.R'))
knitr::read_chunk(here::here('scripts/geospatial_tidy.R'))
knitr::read_chunk(here::here('scripts/plotting.R'))
knitr::read_chunk(here::here('scripts/missing_data.R'))
knitr::read_chunk(here::here('scripts/linear_models.R'))
```

# \*Introduction (incl. pop hypothesis)

The UN have Sustainable Development Goals. One of which is to reduce waste (SDG12?) However another is to increase human prosperity (SDGX?) A measure of prosperity if Gross Domestic Product (GDP).

What is the relationship between gross domestic product (GDP) and household waste? 
One theory would be that increased GDP is linked to an increase in consumerism, and so a positive correlation would be expected. 
On the other hand, high GDP usually means a country has more money to spend on infrastructure, hence a higher recycling rate would be expected and thus a negative correlation would be expected.

United Nations Statistics Division (UNSD) collects data from member states.

# Objectives

The aim of this investigation is to determine whether there is a relationship between national GDP and municipal waste generation. 
After obtaining data from the UNSD, we must tidy the data. 
This involves combining multiple datasets and processing variable so they are comparable. 
Next we should visualise each variable to determine how values are distributed, both statistically and geospatially. 
The datasets being merged do not all cover the same set of countries. 
Therefore the merged dataset will contain some missing values. 
This is addressed by two methods: removal and multiple imputation. 
Linear models are fitted to both "corrected" datasets to determine whether GDP 
and population have an effect on municipal waste generation, and as an evaluation of the missingness methods. 
Limitations of the approach are discussed and final analyses presented in the conclusion.

<!-- 1. Tidy data -->

<!-- 2. Map the data (gdp, waste) -->

<!-- 3. Fix missing data (multiple imputation?) -->

<!-- 4. Linear model across countries (pick a year), across time (pick a country), then multi-variable linear model. -->

<!-- 5*. Factor in population? -->

<!-- 6*. Factor in clustering across regions? -->

<!-- 7. Final analyses presented. -->

<!-- 8. Limitations of approach discussed. -->

# \*Data

```{r load_data}
```

1.  Data sources and types
2.  Visualisation:

-   Table of variables
-   Distribution of values (looks like all should be logged)
-   Map of values

3.  Data merging
4.  Missing data

-   NA removal
-   Multiple imputation

## Data sources

UNSD provides datasets open to the public on various topics related to international development, economic metrics and trade. 
For this investigation data on total municipal waste generation and GDP were needed. Total municipal waste generation was available for the years 1990-2016, aggregated by year and country. [cit] 
GPD per capita data was available for the years 1970-2018, aggregated by year and country. [cit] 
Data for the years 1989-2018 were downloaded for this investigation. 
To allow fair comparison between waste generation and GDP, the waste data was processed to represent municipal waste generated per capita. 
To calculate this we needed population data for each of the corresponding countries and years. 
Population data was available from UNSD for the years 1948-2020, aggregated by year and country. 
Data for the years 1990-2020 were downloaded for this investigation. 
All data was downloaded as Comma Separated Values (CSV) format. 
Municipal waste per capita was calculate by dividing the total municipal waste by the total population, for each year and country in the dataset.

## Data variability {#datavariability}

We can see from the table below that the number of countries covered by each dataset
varies, as does the number of data point each one contains.

|Dataset |Number of countries |Years |Number of values |Max |Min |Unit |
|---:|---:|---:|---:|---:|---:|---:|
|Municipal waste| 128| 1990-2016|  1587|  4.64|     234,471|1000s tonnes |
|GDP per capita | 220| 1989-2018|  6317| 79.95|     189,162|$USD |
|Population     | 239| 1990-2020|  8022|    44| 1,398,000,000|   |
Table: Summary of datasets

This reflects the variability in data collection when working at an internation level,
since data is volunteered by governments to the UN, rather than it being collected
by a central system.

Given that municipal waste generation is our response variable, 
it makes sense to retain the number of entries in this dataset
and match the corresponding entries for countries and years from 
the GDP and population datasets.
The consequences of this are discussed in Sections \@ref(datamerging) and \@ref(missingdata).

To understand how each dataset is distributed
we can plot the distributions of the values and their geographical spreads.

```{r plotsdataprep}
```

```{r wasteplot, include=TRUE, fig.cap="Distribution of municipal waste values. A logarithm of the data appears to have a more normal distribution."}
```

```{r wasteplotgeo, include=TRUE, fig.cap="Geographical distribution of municipal waste values, using most recent year of data for each country in the dataset."}
```

```{r gdpplot, include=TRUE, fig.cap="Distribution of GDP per capita values. A logarithm of the data appears to have a more normal distribution."}
```

```{r gdpplotgeo, include=TRUE, fig.cap="Geographical distribution of GDP per capita values, using most recent year of data for each country in the dataset."}
```

```{r popplot, include=TRUE, fig.cap="Distribution of population values. A logarithm of the data appears to have a more normal distribution."}
```

```{r popplotgeo, include=TRUE, fig.cap="Geographical distribution of population values, using most recent year of data for each country in the dataset."}
```


We can see from Figures \@ref(fig:wasteplot), \@ref(fig:gdpplot) and \@ref(fig:popplot)
that the data are more normally distributed when done so logarithmically.
Therefore we should use log transforms of the data when fitting linear models.

We can see from Figures \@ref(fig:wasteplotgeo), \@ref(fig:gdpplotgeo) and \@ref(fig:popplotgeo)
that each of the datasets don't cover exactly the same set of countries. 
It is also the case that each of the datasets also don't cover the same number 
of years for each country.
We will explore this in Section \@ref(missingdata) below.

## Data merging {#datamerging}

This investigation is trying to understand the variation of municipal waste generation 
with GDP and possibly population. 
Therefore we are treating municipal waste generation as a response variable, 
and GDP and population as explanatory variables. 
We can merge our datasets together, but as we saw in above \@ref(datavariability) 
each dataset does not cover the same number of countries. 
Given municipal waste is our response variable, 
it was chosen to keep all the data from this dataset and merge on only matching countries and years from the other two datasets.

```{r combine_data}
```

## Missing data {#missingdata}

A consequence of merging datasets, as outlined above, was that some of the values for GDP and/or population for some combinations of country and years were missing.

The reasons for these missing entries is that, despite the municipal waste data containing data for fewer countries than GDP or population, not every country in the UN was included in those datasets for every year covered. It is unclear why this is the case. Given that the data is voluntarily submitted to the UN, some of it could be explained as Missing Completely At Random (MCAR) given that some countries could simply have missed the submission deadline for particular years or a country wasn't aware of it's obligations to report for a number of years e.g. an new/young UN member state.

One proposed strategy for dealing with these missing data values is to simply remove any entries which have a missing value for any of the variables. This leads to a \~2% smaller dataset, as seen in Figure \@ref(fig:missmap).

```{r multiple_imputation}
```

```{r missmap, include=TRUE, fig.cap="This graphic highlights the missing values in the merged datset. There are 142 missing values in the GDP per capita variable (`gdp_pc`) and 89 missing values in the total population variable (`pop`)."}
```

Another method would be to use multiple imputation to generate multiple possible complete dataset by sampling (the logarithm of) the non-missing values for each variable. 
This was conducted using the `Amelia` package to create ten imputed datasets. 
The benefit of this was that all values of the response variable, total waste, 
could be retained and converted to waste per capita given the now complete number of population values. 
The multiple imputed datasets allowed a level of uncertainty to be calculated for the resulting linear models.

# \*Analysis & Results

1.  Linear model with NAs removed -\> waste_pc \~ gdp_pc + pop + gdp_pc:pop

|| Intercept| `log(gdp_pc)`|  `log(pop)`| `log(gdp_pc):log(pop)`|
|-:|-----------:|-----------:|---------:|--------------------:|
|Estimate|    5.934065|  -0.543428| -0.686317|            0.060929|
|Standard error|   0.802349|   0.080042| 0.050511|            0.005061|
Table: Caption

Adjusted R$^2$ value was 0.5227

2.  Linear model with MI dataset -\> waste_pc \~ gdp_pc + pop + gdp_pc:pop



|| Intercept| `log(gdp_pc)`|  `log(pop)`| `log(gdp_pc):log(pop)`|
|-:|-----------:|-----------:|---------:|--------------------:|
|Estimate|    4.898117|  -0.4513177| -0.634285|            0.0564811|
|Standard error|   0.7941083|   0.0792634| 0.0500456|            0.0050143|
Table: Caption


3.  Compare the resultin coefficients, standard errors and R$^2$ values

# \*Limitations

-   Didn't account for percentage of population served by municipal waste collection -\> skewed results to lower waste_pc
-   Data on this available -\> {ref}
-   Multiple imputation should have been conducted on the order of the missing values i.e. \~100 times. Did not have computing capacity to do so.
-   MI sampling should probably have been grouped by country, since inter-country variability is probably less normally distributed than intra-country variability.
-   Removing outliers may improve model fitting
-   Compare with UN imputation method
- Latitude values missing from global plots

# \*Conclusion

It would appear that there is a **???** relationship between municipal waste generation per capita and GDP per capita, and a minimally negative correlation between municipal waste generation per capita and total population. The R$^2$ values for the relationships, regardless if using data which was missing-cleansed or multiply-imputed, was \~50% and so didn't particularly well represent the data. Standard errors were ...

It can therefore be said that there is **weak???** correlation between municipal waste generation and GDP, but it is likely that the relationship is much better explained by incporporating other development indicators or social factors.

\pagebreak

# \*References

-   GitHub repo for this project

# Data Sources

<!-- EU GDP (NAMA_10_GDP) -> https://ec.europa.eu/eurostat/databrowser/view/NAMA_10_GDP__custom_188199/default/table -->

<!-- EU Municipal waste (CEI_PC) -> https://ec.europa.eu/eurostat/databrowser/view/cei_pc031/default/table -->

<!-- --- -->

UN GDP <https://data.un.org/Data.aspx?q=gdp&d=SNAAMA&f=grID%3a101%3bcurrID%3aUSD%3bpcFlag%3atrue%3byr%3a1989%2c1990%2c1991%2c1992%2c1993%2c1994%2c1995%2c1996%2c1997%2c1998%2c1999%2c2000%2c2001%2c2002%2c2003%2c2004%2c2005%2c2006%2c2007%2c2008%2c2009%2c2010%2c2011%2c2012%2c2013%2c2014%2c2015%2c2016%2c2017%2c2018&c=1,2,3,5,6&s=_crEngNameOrderBy:asc,yr:desc&v=1>

UN Waste <https://data.un.org/Data.aspx?q=waste+datamart%5BENV%5D&d=ENV&f=variableID%3a1814&c=1,2,3,4,5&s=countryName:asc,yr:desc&v=1>

UN Pop <https://data.un.org/Data.aspx?q=population+datamart%5BENV%2CPOP%5D&d=POP&f=tableCode%3a1%3brefYear%3a1990%2c1991%2c1992%2c1993%2c1994%2c1995%2c1996%2c1997%2c1998%2c1999%2c2000%2c2001%2c2002%2c2003%2c2004%2c2005%2c2006%2c2007%2c2008%2c2009%2c2010%2c2011%2c2012%2c2013%2c2014%2c2015%2c2016%2c2017%2c2018%2c2019%2c2020&c=1,2,3,6,8,10,12,13,14&s=_countryEnglishNameOrderBy:asc,refYear:desc,areaCode:asc&v=1>

<!-- UN Pop served by waste collection -->

<!-- https://data.un.org/Data.aspx?q=waste+datamart%5bENV%5d&d=ENV&f=variableID:1878&c=2,3,4,5&s=countryName:asc,yr:desc&v=1 -->
